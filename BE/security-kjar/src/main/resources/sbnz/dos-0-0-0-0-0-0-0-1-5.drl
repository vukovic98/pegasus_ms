package sbnz;
import com.ftn.uns.ac.rs.hospitalapp.beans.SecurityAlarm;
import java.util.ArrayList;
import java.util.Date;
global ArrayList<SecurityAlarm> alarms;

rule "Redefined log rule for DoS attack - allowing IP adress [ 0:0:0:0:0:0:0:1 ] at most [ 5 ] requests"
	agenda-group "requests"
		$reqe1: RequestEvent($ip: ipAddress, $ip == "0:0:0:0:0:0:0:1")
		Number(intValue >= 5) from accumulate (
			$reqe2: RequestEvent(ipAddress == $ip) over window:time(1m),
			count($reqe2)
		)
		not (DoSEvent())
	then
		System.out.println("DOS ATTACK DETECTED");
        insert(new DoSEvent());
        dosAlarm.setUnderAttack(true);
        alarms.add(new SecurityAlarm("REQUEST FILTER", "DoS ATTACK DETECTED", new Date()));
end


